# Bangumi目录随机抽取器

一个功能强大的网页应用，可以从指定的Bangumi目录中随机抽取游戏作品，支持多种筛选和个性化功能。

## 功能特点

### 核心功能
- 🎲 **随机抽取**: 从Bangumi目录中随机选择一个游戏作品
- 🔐 **OAuth登录**: 支持Bangumi账号登录访问私有目录
- 🎮 **游戏专用**: 专门针对游戏类型作品（type = 4）
- 📱 **响应式设计**: 支持移动端和桌面端
- 🎨 **现代界面**: 美观的渐变色UI设计

### 新增功能
- 📊 **评分筛选**: 按游戏评分范围筛选（0-10分）
- 📅 **年份筛选**: 按游戏发行年份范围筛选
- 📜 **抽取历史**: 记录和管理抽取历史，避免重复抽取
- 🌙 **深色模式**: 一键切换深色/浅色主题
- 🎯 **批量抽取**: 一次抽取多个游戏（2-10个）
- 🔍 **游戏搜索**: 搜索并添加游戏到自定义抽取池

## 使用方法

### 基础功能
1. **获取目录ID**: 在Bangumi网站上找到你想要的目录，从URL中获取目录ID（例如：`https://bgm.tv/index/12345` 中的 `12345`）
2. **搜索目录**: 在搜索框中输入目录ID，点击"搜索目录"按钮
3. **随机抽取**: 目录加载成功后，点击"🎲 随机抽取"按钮
4. **查看结果**: 抽取结果会显示作品的封面图、标题、原名、评分、发行日期等信息

### 高级功能
1. **筛选功能**:
   - 点击"🔍 筛选条件"按钮展开筛选面板
   - 设置年份范围和/或评分范围
   - 点击"应用筛选"按钮

2. **批量抽取**:
   - 在批量抽取输入框中设置数量（2-10）
   - 点击"🎲 批量抽取"按钮
   - 查看网格布局的多个结果

3. **历史记录**:
   - 点击"查看历史"按钮查看抽取历史
   - 勾选"排除已抽取的游戏"避免重复抽取
   - 点击"清空历史"按钮清除所有历史记录

4. **深色模式**:
   - 点击页面顶部的"🌙 深色模式"按钮切换主题
   - 设置会自动保存

5. **自定义游戏池**:
   - 使用"游戏搜索"功能搜索游戏
   - 点击"添加到抽取池"将游戏添加到自定义池
   - 点击"查看自定义池"管理已添加的游戏

## 技术架构

### 前端
- 纯原生JavaScript (ES6+)
- CSS3 渐变和动画效果
- 响应式设计
- LocalStorage持久化存储
- 模块化面向对象设计

### 后端
- Deno + TypeScript
- Bangumi OAuth 2.0集成
- 静态文件服务
- SPA路由支持

### API接口使用
- `GET /v0/indices/{id}` - 获取目录基本信息
- `GET /v0/indices/{id}/subjects` - 获取目录作品列表
- `GET /v0/subjects/{id}` - 获取作品详细信息（包括评分）
- `GET /v0/search/subject/{keywords}` - 搜索游戏
- `GET /v0/me` - 获取用户信息（需登录）

## 部署说明

### 本地开发

1. 设置环境变量（创建 `.env` 文件）：
   ```
   BGM_CLIENT_ID=你的Bangumi应用客户端ID
   BGM_CLIENT_SECRET=你的Bangumi应用客户端密钥
   PORT=8001
   ```

2. 运行服务器：
   ```bash
   deno run --allow-net --allow-read --allow-env server.ts
   ```

3. 访问 `http://localhost:8001`

### 生产环境

可以部署到Deno Deploy或其他支持Deno的托管服务：

1. 在Bangumi开发者平台创建应用：https://bgm.tv/dev/app
2. 设置正确的回调URL：`https://your-domain.com/api/auth/bangumi/callback`
3. 配置环境变量
4. 部署代码

### 仅前端部署

如果不需要登录功能，也可以仅部署静态文件到GitHub Pages、Netlify等平台。但需要注意：
- 无法使用需要认证的API功能
- 某些目录可能因为权限限制无法访问

## 文件结构

```
bangumi-random/
├── index.html          # 主页面
├── style.css           # 样式文件
├── script.js           # 前端逻辑
├── server.ts           # Deno服务器
└── README.md           # 说明文档
```

## 性能优化

- **智能缓存**: 评分筛选时获取的详细数据会被缓存，避免重复请求
- **批量处理**: 每批处理5个游戏，添加延迟避免API限制
- **条件判断**: 只有在需要时才进行复杂的评分筛选
- **数据持久化**: 所有设置和历史记录自动保存到LocalStorage

## 注意事项

1. **目录权限**: 某些私有目录可能需要登录才能访问
2. **作品类型**: 目前只支持游戏类型作品（type = 4）
3. **API限制**: 遵守Bangumi API的使用限制和频率限制
4. **评分筛选**: 使用评分筛选时会稍微增加加载时间，因为需要获取详细信息
5. **浏览器兼容**: 需要支持ES6+的现代浏览器

## 开发说明

### 添加新功能

如果要添加新功能，建议：
1. 在`script.js`中的`BangumiRandomPicker`类中添加新方法
2. 在`index.html`中添加相应的UI元素
3. 在`style.css`中添加样式
4. 如果需要服务器端支持，修改`server.ts`

### 数据结构

项目使用以下主要数据结构：
- **游戏池**: 包含目录游戏和自定义游戏
- **历史记录**: 记录抽取过的游戏和时间
- **筛选条件**: 包含年份范围和评分范围
- **设置**: 包含深色模式和其他用户偏好

## 许可证

本项目仅供学习和个人使用。使用时请遵守Bangumi网站的使用条款。